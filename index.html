<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ø¨ÙˆØªÙ„ Lux - Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js"></script>
    <style>
        :root { --white: #ffffff; --bg: #f8fafc; --blue: #3b82f6; --pink: #ec4899; --green: #10b981; }
        body { font-family: 'Tahoma', sans-serif; background: var(--bg); margin: 0; padding: 15px; direction: rtl; }
        .header { background: var(--white); border-radius: 20px; padding: 15px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; padding-bottom: 140px; }
        .card { background: var(--white); border-radius: 25px; padding: 20px; border: 1px solid #edf2f7; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02); position: relative; }
        .card h3 { margin: 0 0 15px 0; color: var(--blue); font-size: 1.4em; border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; }
        .row { display: flex; justify-content: space-between; align-items: center; margin: 12px 0; }
        .btns { display: flex; align-items: center; gap: 10px; }
        .btn-c { width: 38px; height: 38px; border: none; border-radius: 10px; cursor: pointer; font-size: 1.3em; font-weight: bold; background: #f1f5f9; transition: 0.2s; }
        .btn-blue { background: #dbeafe; color: var(--blue); }
        .btn-pink { background: #fce7f3; color: var(--pink); }
        .profit { background: #dcfce7; color: #065f46; padding: 10px; border-radius: 12px; font-weight: bold; margin-top: 15px; text-align: center; }
        .footer { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 700px; background: white; padding: 15px 25px; border-radius: 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 2px solid var(--blue); z-index: 1000; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0;">Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Lux ğŸ“±â†”ï¸ğŸ“±</h2>
    <div id="status" style="font-size:0.8em; color:orange; margin-top:5px;">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...</div>
</div>

<div class="grid" id="mainGrid"></div>

<div class="footer">
    <div><small>Ø³ÙˆØ¯ Ù…Ø¬Ù…ÙˆØ¹ÛŒ Ø§Ù…Ø±ÙˆØ²:</small><div id="total" style="font-size:1.6em; font-weight:900; color:var(--green);">0 AF</div></div>
    <button onclick="finalize()" style="background:var(--green); color:white; border:none; padding:12px 25px; border-radius:25px; cursor:pointer; font-weight:bold;">Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ</button>
</div>

<script>
    // Ù„Ø³Øª Ú©Ø§Ù…Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ø´Ù…Ø§
    let products = JSON.parse(localStorage.getItem('lux_bottles_v2')) || [
        {name:"Ø³ØªÛŒÙ†Ú¯", stock:60, buy:110, sell:130, sold:0},
        {name:"Ù„ÛŒØªØ±", stock:50, buy:60, sell:80, sold:0},
        {name:"Ø¨ÙˆØ³ØªØ±", stock:40, buy:80, sell:100, sold:0},
        {name:"Ù¾ÛŒØª", stock:30, buy:150, sell:180, sold:0},
        {name:"Ø¢Ø¨ Ù…Ø¹Ø¯Ù†ÛŒ", stock:100, buy:10, sell:20, sold:0},
        {name:"Ø§Ù†Ø±Ú˜ÛŒ Ú©ÛŒÙ†Ú¯", stock:40, buy:40, sell:60, sold:0}
    ];

    // Ø³ÛŒØ³ØªÙ… Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ PeerJS
    const peer = new Peer('lux-store-unique-2026');

    peer.on('open', () => { document.getElementById('status').innerText = "Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø¨Ø§ ØªÛŒÙ„ÙÙˆÙ† Ø¯ÙˆÙ… âœ…"; document.getElementById('status').style.color = "green"; });
    peer.on('connection', (conn) => {
        conn.on('data', (data) => { products = data; render(false); });
    });

    function sync() {
        const conn = peer.connect('lux-store-unique-2026');
        conn.on('open', () => { conn.send(products); });
    }

    function render(shouldSync = true) {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = '';
        let grandTotal = 0;

        products.forEach((p, i) => {
            const pProfit = (p.sell - p.buy) * p.sold;
            grandTotal += pProfit;
            grid.innerHTML += `
                <div class="card">
                    <h3>${p.name}</h3>
                    <div class="row">
                        <span>ğŸ“¦ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ù†Ø¨Ø§Ø±:</span>
                        <div class="btns">
                            <button class="btn-c btn-blue" onclick="updateSt(${i},-1)">-</button>
                            <b style="min-width:30px; text-align:center;">${p.stock}</b>
                            <button class="btn-c btn-blue" onclick="updateSt(${i},1)">+</button>
                        </div>
                    </div>
                    <div class="row">
                        <span>ğŸ›’ ÙØ±ÙˆØ´ Ø§Ù…Ø±ÙˆØ²:</span>
                        <div class="btns">
                            <button class="btn-c btn-pink" onclick="updateSl(${i},-1)">-</button>
                            <b style="min-width:30px; text-align:center; color:var(--pink);">${p.sold}</b>
                            <button class="btn-c btn-pink" onclick="updateSl(${i},1)">+</button>
                        </div>
                    </div>
                    <div class="profit">Ø³ÙˆØ¯: ${pProfit.toLocaleString()} AF</div>
                </div>`;
        });
        document.getElementById('total').innerText = grandTotal.toLocaleString() + " AF";
        localStorage.setItem('lux_bottles_v2', JSON.stringify(products));
        if(shouldSync) sync();
    }

    function updateSt(i, v) { products[i].stock += v; render(); }
    function updateSl(i, v) { if(products[i].sold + v >= 0) { products[i].sold += v; render(); } }

    function finalize() {
        if(confirm("Ø¢ÛŒØ§ Ø­Ø³Ø§Ø¨ Ø§Ù…Ø±ÙˆØ² Ø¨Ø³ØªÙ‡ Ø´ÙˆØ¯ØŸ Ø§Ù†Ø¨Ø§Ø± Ú©Ù… Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.")) {
            products.forEach(p => { p.stock -= p.sold; p.sold = 0; });
            render();
        }
    }

    render(false);
</script>
</body>
</html>
